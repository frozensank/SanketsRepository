<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd">
	<sub-flow name="getProductByName" doc:id="8d98b8f4-5937-406a-873f-e84b53fb134a" >
		<set-variable value='#[output application/json&#10;---&#10;{&#10;  "warehouse": {&#10;    "warehouseId": 123,&#10;    "warehouseName": "xyz",&#10;    "warehouseLocation": "bhivandi",&#10;    "products": [&#10;      {&#10;        "product": {&#10;          "productName": "bat",&#10;          "productCategory": "sport",&#10;          "productId": [1,2,34,4],         &#10;         "productQuantity": 12,&#10;          "productCost": 15000&#10;        }},&#10;		 {&#10;        "product": {&#10;          "productName": "ball",&#10;          "productCategory": "sport",&#10;          "productId": [21,22,34,42],  &#10;          "productQuantity": 15,&#10;          "productCost": 8000&#10;        }},&#10;		{&#10;        "product": {&#10;          "productName": "tshirt",&#10;          "productCategory": "cloths",&#10;          "productId": [41,42,46,49],  &#10;          "productQuantity": 100,&#10;          "productCost": 500&#10;        }},&#10;		{&#10;        "product": {&#10;          "productName": "pant",&#10;          "productCategory": "cloths",&#10;          "productId": [81,82,834,84],  &#10;          "productQuantity": 150,&#10;          "productCost": 8500&#10;        }&#10;      }&#10;    ]&#10;  }&#10;}]' doc:name="Set Variable" doc:id="5aee5cdd-f10b-48f2-9508-1a10b6a85e7d" variableName="warehouse"/>
		<set-payload value='#[output application/json&#10;---&#10;products:&#10;vars.warehouse.warehouse.products filter ($.product.productName == attributes.queryParams.productName) map (object,index)-&gt;{&#10;product : {&#10;              "productId": object.product.productId,&#10;			   "productCategory": object.product.productCategory,&#10;              "productName": object.product.productName,&#10;              "sellingcost": object.product.productCost + (object.product.productCost* 0.1),             &#10;			  "warehouseID":vars.warehouse.warehouse.warehouseId  ,&#10;			  "profit":   object.product.productCost* 0.1       &#10; }&#10;}]' doc:name="Set Payload" doc:id="3e20aef9-bf7d-49fe-954d-a55b4df6338f" />
	</sub-flow>
	<sub-flow name="getProductByCategory" doc:id="464bc1ff-42b8-46df-b75b-5c478d0fc99c" >
		<set-variable value='#[output application/json&#10;---&#10;{&#10;  "warehouse": {&#10;    "warehouseId": 123,&#10;    "warehouseName": "xyz",&#10;    "warehouseLocation": "bhivandi",&#10;    "products": [&#10;      {&#10;        "product": {&#10;          "productName": "bat",&#10;          "productCategory": "sport",&#10;          "productId": [1,2,34,4],         &#10;         "productQuantity": 12,&#10;          "productCost": 15000&#10;        }},&#10;		 {&#10;        "product": {&#10;          "productName": "ball",&#10;          "productCategory": "sport",&#10;          "productId": [21,22,34,42],  &#10;          "productQuantity": 15,&#10;          "productCost": 8000&#10;        }},&#10;		{&#10;        "product": {&#10;          "productName": "tshirt",&#10;          "productCategory": "cloths",&#10;          "productId": [41,42,46,49],  &#10;          "productQuantity": 100,&#10;          "productCost": 500&#10;        }},&#10;		{&#10;        "product": {&#10;          "productName": "pant",&#10;          "productCategory": "cloths",&#10;          "productId": [81,82,834,84],  &#10;          "productQuantity": 150,&#10;          "productCost": 8500&#10;        }&#10;      }&#10;    ]&#10;  }&#10;}]' doc:name="Set Variable" doc:id="42285f5b-7aaf-47a8-ab19-20501659276e" variableName="warehouse"/>
		<set-payload value='#[output application/json&#10;---&#10;products:&#10;vars.warehouse.warehouse.products filter ($.product.productCategory == attributes.queryParams.productCategory) map(object,idx)-&gt;{&#10;	&#10;	product : {&#10;              "productId": object.product.productId,&#10;			   "productCategory": object.product.productCategory,&#10;              "productName": object.product.productName,&#10;              "sellingcost": object.product.productCost + (object.product.productCost* 0.1),&#10;             &#10;			  "warehouseID":vars.warehouse.warehouse.warehouse.warehouseId,&#10;			  "profit":(object.product.productCost* 0.1)&#10;              &#10; }&#10;}]' doc:name="Set Payload" doc:id="823d6df3-b0df-44d8-b3fe-7c8740ecc67b" />
	</sub-flow>
	<sub-flow name="placeOrder" doc:id="2f66b308-57b0-4ca9-827b-fc40b5a610af" >
		<logger level="INFO" doc:name="Logger" doc:id="2cadcd36-dda2-4601-9bdc-f42039864a31" message="#[output application/json&#10;---&#10;vars.order]"/>
		<set-variable value='#[output application/json&#10;---&#10;{&#10;  "warehouse": {&#10;    "warehouseId": 123,&#10;    "warehouseName": "xyz",&#10;    "warehouseLocation": "bhivandi",&#10;    "products": [&#10;      {&#10;        "product": {&#10;          "productName": "bat",&#10;          "productCategory": "sport",&#10;          "productId": [1,2,34,4],         &#10;         "productQuantity": 12,&#10;          "productCost": 15000&#10;        }},&#10;		 {&#10;        "product": {&#10;          "productName": "ball",&#10;          "productCategory": "sport",&#10;          "productId": [21,22,34,42],  &#10;          "productQuantity": 15,&#10;          "productCost": 8000&#10;        }},&#10;		{&#10;        "product": {&#10;          "productName": "tshirt",&#10;          "productCategory": "cloths",&#10;          "productId": [41,42,46,49],  &#10;          "productQuantity": 100,&#10;          "productCost": 500&#10;        }},&#10;		{&#10;        "product": {&#10;          "productName": "pant",&#10;          "productCategory": "cloths",&#10;          "productId": [81,82,834,84],  &#10;          "productQuantity": 150,&#10;          "productCost": 8500&#10;        }&#10;      }&#10;    ]&#10;  }&#10;}]' doc:name="Set Variable" doc:id="ea9d8233-555b-4fdc-bc62-b91d16dab6d6" variableName="warehouse"/>
		<set-variable value='#[%dw 2.0&#10;import * from dw::core::Arrays&#10;output application/json&#10;---&#10; {&#10; "warehouse":{&#10;    "warehouseId": vars.warehouse.warehouse.warehouseId,&#10;    "warehouseName": vars.warehouse.warehouse.warehouseName,&#10;    "warehouseLocation": vars.warehouse.warehouse.warehouseLocation,&#10; "products":flatten&#10;(vars.warehouse.warehouse.products filter ($.product.productName == vars.order.product.productName) map (obj,idx)-&gt;{&#10;&#10;        "product": {&#10;          "productName": obj.product.productName,&#10;          "productCategory":  obj.product.productCategory,&#10;          "productId": obj.product.productId filter ($ != vars.order.product.productId),&#10;         "productQuantity":  obj.product.productQuantity,&#10;          "productCost":  obj.product.productCost&#10;        }&#10;}) ++&#10;(vars.warehouse.warehouse.products filter ($.product.productName !=vars.order.product.productName) map (obj,idx)-&gt;{&#10;&#10;        "product": {&#10;          "productName": obj.product.productName,&#10;          "productCategory":  obj.product.productCategory,&#10;          "productId": obj.product.productId ,&#10;         "productQuantity":  obj.product.productQuantity,&#10;          "productCost":  obj.product.productCost&#10;        }&#10;})&#10;&#10;    },&#10;    "orderstatus": &#10;   (vars.warehouse.warehouse.products&#10; filter ($.product.productName== vars.order.product.productName))[0].product.productId some ($== vars.order.product.productId)  &#10;  &#10;    }]' doc:name="Set Variable" doc:id="c97f7842-5b02-4d46-934f-d39e284e3c17" variableName="warehouse" />
		<set-payload value='#[%dw 2.0&#10;import * from dw::core::Arrays&#10;output application/json&#10;---&#10; {&#10; 	product:{&#10; 	ID: vars.order.product.productId,&#10; 	Name:vars.order.product.productName,&#10; 	warehouse:vars.warehouse.warehouse.warehouseName,&#10; 	cost:vars.order.product.cost&#10;   },&#10;   &#10;  "status": &#10;  (	if (vars.warehouse.orderstatus)&#10;   "order placed"&#10;   else&#10;   "order not placed") ,&#10;&#10;   "warehousedata":vars.warehouse.warehouse&#10;   &#10;   }]' doc:name="Set Payload" doc:id="3cd63524-adec-4015-80eb-c5216affbb2b" />
	</sub-flow>
</mule>
